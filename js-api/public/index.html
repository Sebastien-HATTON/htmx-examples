<html>
  <head>
    <title>htmx JS API</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="reload-client.js" type="module"></script>
    <script>
      htmx.onLoad(body => {
        // If no element with id 'new' exists ...
        if (!htmx.find('#new')) {
          // Create the element and append it to the body.
          const div = document.createElement('div');
          div.setAttribute('id', 'new');
          div.textContent = 'dynamic content';
          // document.body is not set until htmx.onLoad is called.
          body.append(div);
        }

        // Add an event handler to each list item.
        const items = htmx.findAll('ul li');
        for (const item of items) {
          item.addEventListener('click', event => {
            htmx.takeClass(event.target, 'selected');
          });
        }

        // After 5 seconds, click the "Toggle Bullets" button.
        setTimeout(() => {
          htmx.trigger('#toggle-btn', 'click');
        }, 5000);
      });

      // This controls whether htmx processes script tags
      // found in HTML returned by endpoints,
      // like the one returned by the GET /danger request below.
      htmx.config.allowScriptTags = false;

      // This logs all htmx-specific events to
      // the DevTools console for debugging.
      htmx.logAll();

      function changeStyles(event, button) {
        // Change the border color of the section that surrounds the button.
        const section = htmx.closest(button, 'section');
        section.style.borderColor = 'red';

        // Add a CSS class to the element with id 'greet'.
        const greet = htmx.find('#greet');
        htmx.addClass(greet, 'big-red');

        // TODO: How can you prevent this?
        eval('alert("This was executed by eval.")');
      }

      // This provides a way to dynamically and conditionally
      // add event handling.  It is an alternative to
      // applying the hx-on attribute in an element tag.
      htmx.on('#change-btn', 'click', uppercaseItems);

      function uppercaseItems(event) {
        const items = htmx.findAll('ul li');
        for (const item of items) {
          item.textContent = item.textContent.toUpperCase();
        }

        // Stop listening for click events on the button.
        htmx.off('#change-btn', 'click', uppercaseItems);

        // Remove the button.
        htmx.remove(event.target);
      }

      function toggleBullets() {
        const ul = htmx.find('ul');
        htmx.toggleClass(ul, 'no-bullets');
      }

      function debugForm() {
        const form = htmx.find('#my-form');
        const values = htmx.values(form);
        console.log('form values are', values);
      }
    </script>
  </head>
  <body>
    <h1>htmx JS API</h1>

    <section>
      <div>Press this button to change some styles.</div>
      <!-- `this` holds the current element. -->
      <button hx-on:click="changeStyles(event, this)">Change Styles</button>
    </section>

    <div id="greet" hx-on:click="htmx.removeClass(this, 'big-red')">
      Hello, World!
    </div>

    <hr />

    <button hx-get="/danger" hx-target="#result">Fetch</button>
    <div id="result"></div>

    <hr />

    <ul>
      <li>Red</li>
      <li>Green</li>
      <li>Blue</li>
    </ul>
    <button id="change-btn">Uppercase Items</button>
    <button id="toggle-btn" hx-on:click="toggleBullets()">
      Toggle Bullets
    </button>

    <hr />

    <form id="my-form">
      <label>
        Name
        <input type="text" name="name" />
      </label>
      <br />
      <label>
        Age
        <input type="number" name="age" />
      </label>
    </form>
    <button hx-on:click="debugForm()">Debug Form</button>
  </body>
</html>
