<html>
  <head>
    <title>htmx Demo</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- <script src="https://unpkg.com/htmx.org@2.0.2"></script> -->
    <script src="reload-client.js" type="module"></script>

    <script type="module">
      try {
        const res = await fetch('/api-key');
        const apiKey = await res.text();
        const script = document.createElement('script');
        script.async = true;
        script.defer = true;
        script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
        document.head.appendChild(script);
      } catch (e) {
        console.error(e);
      }
    </script>
    <script>
      const lat = 38.70955;
      const lng = -90.59491;

      async function initMap() {
        // To get a map id, browse
        // https://console.cloud.google.com/google/maps-apis/studio/maps
        // and click the "CREATE MAP ID" button.
        const mapId = 'b58458d80fd75312';
        const center = {lat, lng};
        var map = new google.maps.Map(document.getElementById('map'), {
          center,
          mapId,
          //mapTypeId: google.maps.MapTypeId.SATELLITE,
          mapTypeId: google.maps.MapTypeId.HYBRID, // adds labels to satellite
          zoom: 15
        });

        const {AdvancedMarkerElement, PinElement} =
          await google.maps.importLibrary('marker');
        const marker = new google.maps.marker.AdvancedMarkerElement({
          map,
          position: center,
          title: 'Home' // tooltip when hovering over marker
        });

        addBoundary(map);
      }

      function addBoundary(map) {
        const delta = 0.001;
        const paths = [
          {lat: lat - delta, lng: lng - delta},
          {lat: lat + delta, lng: lng - delta},
          {lat: lat + delta, lng: lng + delta},
          {lat: lat - delta, lng: lng + delta}
        ];
        const overlay = new google.maps.Polygon({
          paths: paths,
          strokeColor: '#FF0000', // Red border
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000', // Red fill
          fillOpacity: 0.35
        });
        overlay.setMap(map);
      }
    </script>
  </head>
  <body>
    <!--gmp-map
      center="38.70955,-90.59491"
      map-id="myMapId"
      type="roadmap"
      zoom="15"
    >
      <gmp-advanced-marker
        position="38.70955,-90.59491"
        title="Home"
      ></gmp-advanced-marker>
    </gmp-map-->
    <div id="map"></div>
  </body>
</html>
